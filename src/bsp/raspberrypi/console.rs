use crate::console;
use core::fmt;

//-------------------------------------------------------------------------------------------------
// Private Definitions
//-------------------------------------------------------------------------------------------------

struct QEMUOutput;

//-------------------------------------------------------------------------------------------------
// Private Code
//-------------------------------------------------------------------------------------------------
impl fmt::Write for QEMUOutput {
    fn write_str(&mut self, s: &str) -> fmt::Result {
        for c in s.chars() {
            unsafe {
                // 0x3f20_1000はどういう意味のマジックナンバー?
                // qemuの標準出力のための特別なアドレスらしい
                // 後でUARTを使った出力に変更する
                core::ptr::write_volatile(0x3F20_1000 as *mut u8, c as u8);
            }
        }
        Ok(())
    }
}

//-------------------------------------------------------------------------------------------------
// Public Code
//-------------------------------------------------------------------------------------------------
pub fn console() -> impl console::interface::Write {
    QEMUOutput {}
}
